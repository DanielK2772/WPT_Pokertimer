<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WPT Pokertimer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@700&display=swap');

:root {
    --bg-dark:#022c22;
    --card-bg:#064e3b;
}

body {
    background:var(--bg-dark);
    font-family:'Inter',sans-serif;
    color:white;
}

.timer-font {
    font-family:'JetBrains Mono',monospace;
    font-variant-numeric:tabular-nums;
}

.glass-card {
    background:var(--card-bg);
    border:1px solid rgba(255,255,255,.05);
    border-radius:1rem;
}

.stat-number {
    color:rgba(255,255,255,.9);
    font-weight:800;
}

.pulse-red { animation:pulse 1s infinite; }
@keyframes pulse { 0%,100%{opacity:1}50%{opacity:.4} }
</style>
</head>

<body class="flex flex-col min-h-screen">

<header class="p-4 bg-black/40 flex justify-between items-center border-b border-white/10">
    <h1 class="font-black uppercase tracking-widest">
        WPT <span class="text-red-500">Pokertimer</span>
    </h1>
</header>

<main class="flex-grow p-4 max-w-6xl mx-auto w-full space-y-4">

<!-- TIMER -->
<div class="glass-card p-6 text-center">
    <div class="flex justify-between items-center mb-2">
        <div id="levelLabel" class="uppercase tracking-widest text-white/40 font-bold">Level 1</div>
        <div>
            <div class="text-[10px] uppercase text-white/40 font-bold">Next Break in</div>
            <div id="timeToBreakDisplay" class="stat-number text-xl font-mono">00:00:00</div>
        </div>
    </div>

    <div id="timerDisplay" class="timer-font text-7xl my-4">20:00</div>

    <div class="border-t border-white/10 pt-4">
        <div class="text-6xl font-black text-red-500">
            <span id="sbDisplay">100</span> /
            <span id="bbDisplay">200</span>
        </div>

        <div class="mt-3 flex justify-center gap-8">
            <div>
                <span class="text-[10px] uppercase text-white/40">Next:</span>
                <span id="blindsNextPreview" class="stat-number ml-1">200 / 400</span>
            </div>
            <div>
                <span class="text-[10px] uppercase text-white/40">Players:</span>
                <span id="playersMiniStat" class="stat-number ml-1">0 / 0</span>
            </div>
        </div>
    </div>
</div>

<!-- STATS -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-3">
    <div class="glass-card p-3 text-center">
        <div class="text-[10px] uppercase text-white/40 font-bold">Prize Pool</div>
        <div id="prizePoolDisplay" class="text-green-400 font-bold text-xl">0 €</div>
    </div>
    <div class="glass-card p-3 text-center">
        <div class="text-[10px] uppercase text-white/40 font-bold">Avg Stack</div>
        <div id="avgStackDisplay" class="text-yellow-400 font-bold text-xl">0</div>
    </div>
    <div class="glass-card p-3 text-center">
        <div class="text-[10px] uppercase text-white/40 font-bold">Entries (B/R/A)</div>
        <div id="braTotals" class="stat-number text-xl">0 / 0 / 0</div>
    </div>
    <div class="glass-card p-3 text-center">
        <div class="text-[10px] uppercase text-white/40 font-bold">Total Time</div>
        <div id="totalTimeDisplay" class="stat-number font-mono">00:00:00</div>
    </div>
</div>

</main>

<footer class="p-4 bg-black/50 flex justify-center gap-4 border-t border-white/10 sticky bottom-0">
    <button id="toggleBtn" class="bg-red-600 px-6 py-3 rounded-xl font-black uppercase">
        Start / Pause
    </button>
</footer>

<script>
/* =========================
   LOCAL STORAGE
========================= */
const STORAGE_KEY = 'wpt-pokertimer-state-v1';

/* =========================
   STATE
========================= */
let state = {
    isRunning:false,
    currentTime:1200,
    currentLevel:0,
    totalTime:0,
    players:[],
    buyInCost:20,
    structure:[
        {type:'level',sb:100,bb:200,duration:20},
        {type:'level',sb:200,bb:400,duration:20},
        {type:'break',duration:10},
        {type:'level',sb:300,bb:600,duration:20}
    ]
};

/* =========================
   RESTORE STATE
========================= */
const saved = localStorage.getItem(STORAGE_KEY);
if (saved) {
    try { state = JSON.parse(saved); } catch {}
}

/* =========================
   SAVE STATE
========================= */
function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* =========================
   BEFORE UNLOAD
========================= */
let dirty = false;
function markDirty() { dirty = true; }

window.addEventListener('beforeunload', e => {
    if (!dirty) return;
    e.preventDefault();
    e.returnValue = '';
});

/* =========================
   UTIL
========================= */
const fmt = s =>
    `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;

const fmtFull = s =>
    `${String(Math.floor(s/3600)).padStart(2,'0')}:${String(Math.floor((s%3600)/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;

/* =========================
   UI UPDATE
========================= */
function updateUI() {
    const lvl = state.structure[state.currentLevel];

    timerDisplay.textContent = fmt(state.currentTime);
    sbDisplay.textContent = lvl.sb || '';
    bbDisplay.textContent = lvl.bb || '';

    let next = state.structure.find((x,i)=>i>state.currentLevel && x.type==='level');
    blindsNextPreview.textContent = next ? `${next.sb} / ${next.bb}` : 'MAX';

    playersMiniStat.textContent = `${state.players.filter(p=>p.active).length} / ${state.players.length}`;

    prizePoolDisplay.textContent =
        `${state.players.length * state.buyInCost} €`;

    braTotals.textContent =
        `${state.players.length} / 0 / 0`;

    totalTimeDisplay.textContent = fmtFull(state.totalTime);

    timeToBreakDisplay.textContent = '—';
}

/* =========================
   TIMER
========================= */
let interval = null;

toggleBtn.onclick = () => {
    markDirty();
    if (state.isRunning) {
        clearInterval(interval);
        state.isRunning = false;
    } else {
        state.isRunning = true;
        interval = setInterval(()=>{
            state.currentTime--;
            state.totalTime++;
            if (state.currentTime <= 0) nextLevel();
            updateUI();
            saveState();
        },1000);
    }
};

function nextLevel() {
    if (state.currentLevel < state.structure.length-1) {
        state.currentLevel++;
        state.currentTime = state.structure[state.currentLevel].duration * 60;
    }
}

/* =========================
   INIT
========================= */
updateUI();
saveState();
</script>

</body>
</html>
